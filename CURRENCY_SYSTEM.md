# Система валют и геолокации

## Обзор

Система автоматически определяет страну пользователя и отображает соответствующие валюты для оплаты курса.

## Как это работает

### 1. Определение страны
- **Основной сервис**: `ipapi.co/json/`
- **Альтернативный сервис**: `ip-api.com`
- **Кэширование**: Результат кэшируется на 1 час
- **Fallback**: Если сервисы недоступны, используется `'US'`

### 2. Отображение валют по странам

| Страна | Код | Доступные валюты |
|--------|-----|------------------|
| Россия | RU | USD, EUR, RUB, USDT |
| Украина | UA | USD, EUR, UAH, USDT |
| Все остальные | - | USD, EUR, USDT |

### 3. Компоненты системы

#### useGeolocation
```typescript
const { location, loading, error } = useGeolocation();
```
- Определяет страну пользователя
- Кэширует результат
- Обрабатывает ошибки

#### useAvailableCurrencies
```typescript
const currencies = useAvailableCurrencies(location);
```
- Возвращает список валют для указанной страны
- Использует CurrencyService для логики

#### CurrencyService
```typescript
CurrencyService.getAvailableCurrencies(location)
```
- Содержит логику определения валют по стране
- Поддерживает все валюты: USD, EUR, RUB, UAH, USDT

### 4. Тестирование

Для тестирования можно использовать localStorage:
```javascript
// Установить тестовую страну
localStorage.setItem('testLocation', 'UA');

// Очистить тестовую страну
localStorage.removeItem('testLocation');

// Очистить кэш геолокации
localStorage.removeItem('cachedLocation');
localStorage.removeItem('cachedLocationTime');
```

### 5. VPN поддержка

Система автоматически работает с VPN:
1. При смене VPN на новую страну
2. Нажмите "Обновить геолокацию" (если есть кнопка)
3. Или очистите кэш и перезагрузите страницу

### 6. Производительность

- **Кэширование**: Результаты кэшируются на 1 час
- **Fallback**: Работает даже при недоступности сервисов
- **Асинхронность**: Не блокирует интерфейс

### 7. Безопасность

- Используются только публичные API
- Нет передачи персональных данных
- Кэш хранится только локально

## Структура файлов

```
src/
├── hooks/
│   ├── useGeolocation.ts          # Определение страны
│   └── useAvailableCurrencies.ts  # Получение валют
├── services/
│   └── CurrencyService.ts         # Логика валют
└── components/
    └── sections/
        └── PricingPlansPayment.tsx # Отображение валют
```

## Добавление новых стран

1. Обновите `CurrencyService.getAvailableCurrencies()`
2. Добавьте новую логику для страны
3. Протестируйте с VPN

## Мониторинг

Система логирует только критические ошибки в консоль:
- `console.warn()` при недоступности сервисов геолокации
- Остальные отладочные сообщения удалены для продакшена
